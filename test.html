<!doctype html>
<html>
<title>Custom Element Registration - PerfTests</title>

<head>
    <style>
        h1 {
            font-size: 18px;
            color: #204d74;
        }

        table {
            width: 100%;
            text-align: left;
            font-size: 14px;
            color: #0b97c4;
        }

        table tr td {
            padding: 2px;
            margin: 0px;
            border-bottom: 1px grey solid;
        }
        
        #result-table td:first-child {
            text-align: right;
        }
        
        #config tr td {
            border-bottom: 0px !important;
        }

        #support-status,
        #polyfill-status {
            padding: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .warning {
            border: 1px #c12e2a solid;
            color: #c12e2a;
        }

        .success {
            border: 1px #4cae4c solid;
            color: #4cae4c;
        }
        
        a {
            text-decoration: none;
            color: black;
        }
        
        a:hover {
            text-decoration: underline;
        },
        
        #toggleBoxes {
            padding: 5px !important;
        }
    </style>
</head>

<body>
<h2>Web Components - bleeding edge limits test configurator</h2>

<div id="polyfill-status">
    <span id="polyfill-enabled-status"></span>
    <div>Switch between: <a href="?polyfilled">polyfilled</a> and <a href="?">not polyfilled</a> version.</div>
</div>
<div id="support-status"></div>

<table id="config">
<tr>
    <td>Repeat from zero to:</td> <td><input type="text" value="10000" id="repeatFromZeroTo"></td>
<tr>
<tr>
    <td>Step factor:</td> <td><input type="text" value="10" id="stepFactor"></td>
<tr>
<tr>
    <td>Repetitions count for each test:</td> <td><input type="text" value="100" id="repetitionCount"></td>
</tr>
<tr>
    <td colspan="2"></td>
</tr>
<tr>
    <td colspan="2">Test Cases:</td>
</tr>
<tr>
    <td colspan="2">
        <fieldset>
        <legend>Test Cases</legend>
            <input type="checkbox" onclick="toggleAll()"> <strong>Toggle all</strong><br>
            <br>
            <div id="toggleBoxes"><!-- auto-generated checkboxes ---></div>
    </fieldset>
    </td>
</tr>
<tr>
    <td colspan="2" style="text-align: left;"><input type="button" value="START THE TEST" onclick="runAllTests()"> Status: <span id="status">waiting</span></td>
</tr>
</table>

<br><br>

<table id="result-table">
    <tr>
        <th>TestSuite</th>
        <th>#</th>
        <th>Title</th>
        <th>Duration</th>
    </tr>
    <template id="row-template">
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </template>
</table>
</body>

<!-- test suite helper -->
<script src="testsuite-logger.js"></script>
<script src="testsuite-helpers.js"></script>

<!-- test suites -->
<script src="custom-element-register.js"></script>
<script src="shadow-root.js"></script>
<script src="shadow-root-complex.js"></script>
<script src="no-components.js"></script>

<script>
    'use strict';
    
    // *** define test suites here ***
    var testSuites = [
        testSuiteCustomElements,
        testSuiteShadowRoot,
        testSuiteShadowRootComplex,
        testSuiteNoComponents
    ];
    
    var tableEmpty;
    var table = document.querySelector('#result-table');

    document.addEventListener("DOMContentLoaded", function (event) {
        var statusEnabledEl = document.querySelector('#polyfill-enabled-status');
        var statusEl = document.querySelector('#polyfill-status');
        
        if (location.search.indexOf("polyfilled") != -1) {
            var script = document.createElement("script");
            script.src = "webcomponents_0.5.4.js";
            document.head.appendChild(script);
            
            //script.onload = browserCheck;
            
            statusEnabledEl.innerHTML = 'You are using polyfills for the tests.';
            statusEl.classList.add('success');
        } else {
            statusEnabledEl.innerHTML = 'You are NOT using polyfills for the tests.';
            statusEl.classList.add('warning');
            
            //browserCheck();
        }
        
        tableEmpty = table.cloneNode(true);
        
        // build up checkboxes for all test suites
        buildTestCheckboxes();
    });
    
    function buildTestCheckboxes() {
        var tbs = toggleBoxes;
        
        for (var i = 0; i < testSuites.length; i++) {
            var testCases = testSuites[i].getTestFunctions();
            
            for (var j = 0; j < testCases.length; j++) {
                var descr = testSuites[i].getSuiteName() + ' #' + (j + 1) + ': ' + testSuites[i].getTestDescr()[j];
                var id = (i + '' + j);
                tbs.innerHTML += '<div><input type="checkbox" id="testcase-' + id + '" data-testsuite="' + i + '" data-testcase="' + j + '"> <label for="testcase-' + id + '">' + descr + '</label></div>';
            }
        }
    }
    
    function browserCheck() {
        var status = document.querySelector('#support-status');

        // checking for Web Components support (credit to: Glen Maddern, geelen on GitHub)
        if ('registerElement' in document
                && 'createShadowRoot' in HTMLElement.prototype
                && 'import' in document.createElement('link')
                && 'content' in document.createElement('template')) {

            // this browser has full Web Components support
            status.setAttribute('class', 'success');
            status.innerHTML = 'Web Components are FULLY supported in this browser!';
        } else {
            status.setAttribute('class', 'warning');
            status.innerHTML = 'Web Components are NOT fully supported in this browser!';
        }
    }
    
    function runAllTests() {
        var statusText = document.getElementById('status');
        
        var zt = +document.querySelector('#repeatFromZeroTo').value;
        var rc = +document.querySelector('#repetitionCount').value;
        var sf = +document.querySelector('#stepFactor').value;
        
        if (rc <= 1 || sf <= 0 || zt <= 0) {
            statusText.innerHTML = 'Please enter a number greater than zero. Repetition count must be > 1';
            return;
        }
        
        statusText.innerHTML = 'Test is running.'
        
        table.innerHTML = '';
        table.appendChild(tableEmpty);
        
        var repeatFromZeroTo = zt;
        var stepFactor = sf;
        var repetitionCount = rc;
        
        var cbs = document.querySelectorAll('#toggleBoxes input[type=checkbox]');
        for (var i = 0; i < cbs.length; i++) {
            if (cbs[i].checked) {
                var testSuiteNo = cbs[i].getAttribute('data-testsuite');
                var testCaseNo = cbs[i].getAttribute('data-testcase');
                var testFunc = testSuites[testSuiteNo].getTestFunctions()[testCaseNo];
                testSuiteHelpers.repeator(testFunc, repeatFromZeroTo, stepFactor, repetitionCount);
                testSuiteLogger.addSeparator();
            }
        }
        testSuiteLogger.flush();
        
        statusText.innerHTML = 'Test is done.';
    }
    
    function toggleAll() {
        var cbs = document.querySelectorAll('#toggleBoxes input[type=checkbox]');
    
        for (var i = 0; i < cbs.length; i++) {
            cbs[i].checked = cbs[i].checked ? false : true;
        };
    }
</script>
</html>